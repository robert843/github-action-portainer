name: Continuous Deployment do Portainer

on:
  workflow_dispatch: # Opcjonalnie: Umo≈ºliwia rƒôczne uruchomienie

jobs:
  deploy-to-portainer:
    runs-on: ubuntu-latest

    # ‚ö†Ô∏è Wa≈ºne: Wymagane uprawnienia do pobrania tokenu PAT z Secrets
    permissions:
      contents: read

    steps:
      - name: Checkout Code (Wymagane tylko, je≈õli u≈ºywamy plik√≥w z tego repozytorium)
        uses: actions/checkout@v4

      - name: Deploy Stos do Portainera üöÄ
        # U≈ºycie Twojej Akcji z odpowiednim tagiem wersji
        # U≈ºytkownik musi zmieniƒá 'twoja-org/nazwa-twojego-repozytorium' na poprawnƒÖ ≈õcie≈ºkƒô
        uses: robert843/github-action-portainer@v0.0.15

        with:
          # --- Parametry Portainera (Uwierzytelnianie) ---
          portainer-host: 'http://localhost:9000'
          api-key: 'test'
          # LUB: username: ${{ secrets.PORTAINER_USER }}
          # LUB: password: ${{ secrets.PORTAINER_PASS }}

          # --- Parametry Wdro≈ºenia Stosu ---
          stack-name: moj-serwis-backend
          endpoint-name: Produkcja-Swarm-Cluster # U≈ºywamy nazwy endpointu
          deployment-method: repository

          # --- Parametry Repozytorium Git (Prywatne) ---
          repository-url: https://github.com/moja-firma/prywatne-repo-app.git
          compose-file-path: docker-compose-prod.yml # Je≈õli plik ma innƒÖ nazwƒô

          # --- Opcjonalne Opcje Swarm ---
          prune: 'true' # Wymu≈õ usuniƒôcie starych us≈Çug
          pull-image: 'true' # Wymu≈õ pobranie najnowszych obraz√≥w
          access: 'team'
          teams: 'devops,backend-team'