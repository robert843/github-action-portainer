name: Continuous Deployment do Portainer

on:
  workflow_dispatch: # Opcjonalnie: Umo≈ºliwia rƒôczne uruchomienie

jobs:
  deploy-to-portainer:
    runs-on: ubuntu-latest

    # ‚ö†Ô∏è Wa≈ºne: Wymagane uprawnienia do pobrania tokenu PAT z Secrets
    permissions:
      contents: read

    steps:
      - name: Checkout Code (Wymagane tylko, je≈õli u≈ºywamy plik√≥w z tego repozytorium)
        uses: actions/checkout@v4

      - name: üöÄ Deploy Stos do Portainera
        id: portainer_deploy
        # U≈ºycie Twojej Akcji z odpowiednim tagiem wersji
        # U≈ºytkownik musi zmieniƒá 'twoja-org/nazwa-twojego-repozytorium' na poprawnƒÖ ≈õcie≈ºkƒô
        uses: robert843/github-action-portainer@v0.0.22

        with:
          # --- Parametry Portainera (Uwierzytelnianie) ---
          portainer-host: 'http://localhost:9000'
          api-key: 'test'
          # LUB: username: ${{ secrets.PORTAINER_USER }}
          # LUB: password: ${{ secrets.PORTAINER_PASS }}

          # --- Parametry Wdro≈ºenia Stosu ---
          stack-name: moj-serwis-backend
          endpoint-name: Produkcja-Swarm-Cluster # U≈ºywamy nazwy endpointu
          deployment-method: repository

          # --- Parametry Repozytorium Git (Prywatne) ---
          repository-url: ${{ github.server_url }}/${{ github.repository }}
          compose-file-path: docker-compose.yml # Je≈õli plik ma innƒÖ nazwƒô
          access: 'public'
      - name: üí¨ Dodanie komentarza o powodzeniu (URL)
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number || github.sha }}
          body: |
            Stack **${{ steps.portainer_deploy.with.stack-name }}** zosta≈Ç pomy≈õlnie zaktualizowany...